<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Neo WebOS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --accent:#22c55e;
  --dark:#0f0f0f;
  --gray:#1e1e1e;
  --lightgray:#2a2a2a;
  --text:#e5e7eb;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",sans-serif}
body,html{width:100%;height:100%;overflow:hidden;background:var(--dark);color:var(--text)}

/* èƒŒæ™¯ */
#desktop{
  width:100%;height:100%;position:relative;
  background:
    radial-gradient(circle at 20% 30%, #1f2937 0%, transparent 40%),
    radial-gradient(circle at 80% 70%, #064e3b 0%, transparent 40%),
    linear-gradient(120deg,#0f0f0f,#1e1e1e);
}

/* ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ */
.window{
  width:520px;height:360px;background:var(--gray);
  border:1px solid #2f2f2f;border-radius:12px;
  position:absolute;top:100px;left:180px;
  box-shadow:0 20px 60px rgba(0,0,0,.6);
  display:none;flex-direction:column;overflow:hidden;
}
.titlebar{
  background:var(--lightgray);padding:10px;
  display:flex;justify-content:space-between;align-items:center;
  border-bottom:1px solid #333;cursor:move;
}
.content{flex:1;padding:15px;overflow:auto}

/* ã‚¿ã‚¹ã‚¯ãƒãƒ¼ */
#taskbar{
  position:absolute;bottom:0;width:100%;height:48px;
  background:rgba(30,30,30,.75);backdrop-filter:blur(12px);
  display:flex;align-items:center;padding:0 12px;border-top:1px solid #2a2a2a;
}
.start{width:36px;height:36px;border-radius:8px;background:var(--lightgray);cursor:pointer}
.widgets-btn{margin-left:auto;padding:6px 12px;background:var(--lightgray);
  border:1px solid #333;border-radius:8px;cursor:pointer;color:var(--accent)}

/* ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
#startMenu{
  position:absolute;bottom:60px;left:12px;width:260px;
  background:#1b1b1b;border:1px solid #333;border-radius:12px;
  padding:15px;display:none;
}
.start-item{padding:8px;border-radius:6px;cursor:pointer}
.start-item:hover{background:#2a2a2a}

/* ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ */
#widgets{
  position:absolute;right:-360px;top:0;width:360px;height:100%;
  background:rgba(20,20,20,.95);backdrop-filter:blur(20px);
  border-left:1px solid #333;padding:15px;transition:.4s;overflow-y:auto;
}
#widgets.open{right:0}
.widget-section{margin-bottom:20px}
.widget-section h3{color:var(--accent);margin-bottom:10px;font-size:16px;border-bottom:1px solid #333;padding-bottom:5px}
.news-item{font-size:13px;margin-bottom:8px;cursor:pointer;border-bottom:1px solid #2a2a2a;padding-bottom:6px}
.weather-item{font-size:14px;margin-bottom:6px}
</style>
</head>
<body>

<div id="desktop">

  <!-- ãƒ‹ãƒ¥ãƒ¼ã‚¹è¡¨ç¤ºç”¨ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
  <div class="window" id="newsWindow">
    <div class="titlebar">ãƒ‹ãƒ¥ãƒ¼ã‚¹</div>
    <div class="content" id="newsContent">è¨˜äº‹ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
  </div>

  <div id="taskbar">
    <div class="start" onclick="toggleStart()"></div>
    <div class="widgets-btn" onclick="toggleWidgets()">ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»å¤©æ°—</div>
  </div>

  <div id="startMenu">
    <div class="start-item" onclick="openWidgets()">ğŸ“° ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»å¤©æ°—</div>
    <div class="start-item" onclick="alert('è¨­å®šã¯ã¾ã æœªå®Ÿè£…')">âš™ è¨­å®š</div>
  </div>

  <div id="widgets">
    <div class="widget-section">
      <h3>ğŸŒ¤ å¤©æ°—</h3>
      <div id="weather">å–å¾—ä¸­...</div>
    </div>
    <div class="widget-section">
      <h3>ğŸ“° ãƒ‹ãƒ¥ãƒ¼ã‚¹</h3>
      <div id="news">å–å¾—ä¸­...</div>
    </div>
  </div>

</div>

<script>
/* UIãƒˆã‚°ãƒ« */
function toggleWidgets(){document.getElementById("widgets").classList.toggle("open")}
function toggleStart(){startMenu.style.display=startMenu.style.display==="block"?"none":"block"}
function openWidgets(){document.getElementById("widgets").classList.add("open");toggleStart()}

/* ===== åœ°åŸŸã‚³ãƒ¼ãƒ‰è‡ªå‹•å–å¾— ===== */
async function getLocalCode(){
  return new Promise(resolve=>{
    navigator.geolocation.getCurrentPosition(async pos=>{
      const {latitude,longitude}=pos.coords;
      const res=await fetch(`https://geocoding-api.open-meteo.com/v1/reverse?latitude=${latitude}&longitude=${longitude}&language=ja`);
      const data=await res.json();
      const pref=data.results[0].admin1;
      const map={
        "æ±äº¬éƒ½":"130000","å¤§é˜ªåºœ":"270000","åŒ—æµ·é“":"016000",
        "æ„›çŸ¥çœŒ":"230000","ç¦å²¡çœŒ":"400000"
      };
      resolve(map[pref]||"130000");
    },()=>resolve("130000"));
  });
}

/* ===== å¤©æ°—å–å¾— ===== */
async function loadWeather(){
  const code=await getLocalCode();
  const res=await fetch(`https://www.jma.go.jp/bosai/forecast/data/forecast/${code}.json`);
  const data=await res.json();
  const area=data[0].timeSeries[0].areas[0];
  weather.innerHTML=`
    <div class="weather-item">${area.area.name}</div>
    <div class="weather-item">ä»Šæ—¥: ${area.weathers[0]}</div>
    <div class="weather-item">æ˜æ—¥: ${area.weathers[1]}</div>`;
}

/* ===== ãƒ‹ãƒ¥ãƒ¼ã‚¹å–å¾— ===== */
async function loadNews(){
  const rss="https://www3.nhk.or.jp/rss/news/cat0.xml";
  const url="https://api.allorigins.win/raw?url="+encodeURIComponent(rss);
  const res=await fetch(url);
  const text=await res.text();
  const xml=new DOMParser().parseFromString(text,"text/xml");
  const items=[...xml.querySelectorAll("item")].slice(0,5);
  news.innerHTML="";
  items.forEach(i=>{
    const title=i.querySelector("title").textContent;
    const link=i.querySelector("link").textContent;
    const div=document.createElement("div");
    div.className="news-item";
    div.textContent="ãƒ»"+title;
    div.onclick=()=>openNews(link);
    news.appendChild(div);
  });
}

/* ===== ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦è¡¨ç¤º ===== */
function openNews(url){
  const win=document.getElementById("newsWindow");
  win.style.display="flex";
  newsContent.innerHTML=`<iframe src="${url}" style="width:100%;height:100%;border:none"></iframe>`;
}

/* ===== 10åˆ†ã”ã¨æ›´æ–° ===== */
loadWeather(); loadNews();
setInterval(loadWeather,600000);
setInterval(loadNews,600000);
</script>

</body>
</html>
